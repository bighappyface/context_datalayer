<?php

class ContextDatalayerConditionPathTest extends DrupalWebTestCase {
  protected $profile = 'testing';

  public static function getInfo() {
    return array(
      'name' => 'Condition: path',
      'description' => 'Test path condition.',
      'group' => 'ContextDatalayer',
    );
  }

  function setUp() {
    parent::setUp('context', 'ctools', 'path');
    $admin_user = $this->drupalCreateUser(array('administer site configuration', 'administer nodes'));
    $this->drupalLogin($admin_user);
  }

  function test() {
    ctools_include('export');
    $context = ctools_export_new_object('context');
    $context->name = 'testcontext';
    $context->conditions = array('path' => array('values' => array('admin', 'node/*')));
    $context->reactions = array('debug' => array('debug' => TRUE));
    $saved = context_save($context);
    $this->assertTrue($saved, "Context 'testcontext' saved.");

    $this->drupalGet('admin');
    $this->assertText('Active context: testcontext');

    $node = $this->drupalCreateNode();
    $this->drupalGet("node/{$node->nid}");
    $this->assertText('Active context: testcontext');

    $this->drupalGet('node');
    $this->assertNoText('Active context: testcontext');

    // Cleanup
    context_delete($context);

    // @TODO: Test with path alias
    // @TODO: Test with language prefixes
  }
}
